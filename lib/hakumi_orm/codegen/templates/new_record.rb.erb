# typed: strict
# frozen_string_literal: true
# GENERATED BY hakumi-orm -- DO NOT EDIT

<%- if module_name -%>
module <%= module_name %>
<%- end -%>
<%= ind %>class <%= record_class_name %>
<%= ind %>  class New
<%= ind %>    extend T::Sig

<%- columns.each do |col| -%>
<%= ind %>    sig { returns(<%= col[:ruby_type] %>) }
<%= ind %>    attr_reader :<%= col[:name] %>

<%- end -%>
<%= ind %>    sig { params(<%= init_sig_params %>).void }
<%= ind %>    def initialize(<%= init_args %>)
<%- columns.each do |col| -%>
<%= ind %>      @<%= col[:name] %> = T.let(<%= col[:name] %>, <%= col[:ruby_type] %>)
<%- end -%>
<%= ind %>    end
<%- if insert_sql -%>

<%= ind %>    SQL_INSERT = T.let('<%= insert_sql %>', String)

<%= ind %>    sig { params(adapter: ::HakumiORM::Adapter::Base).returns(<%= record_class_name %>) }
<%= ind %>    def save!(adapter: ::HakumiORM.adapter)
<%= ind %>      result = adapter.exec_params(SQL_INSERT, [<%= bind_list %>])
<%= ind %>      record = <%= record_class_name %>.from_result(result).first
<%= ind %>      raise ::HakumiORM::Error, "INSERT returned no rows" unless record
<%= ind %>
<%= ind %>      record
<%= ind %>    ensure
<%= ind %>      result&.close
<%= ind %>    end
<%- end -%>
<%= ind %>  end
<%= ind %>end
<%- if module_name -%>
end
<%- end -%>
